@model ProductViewModel;
@{
	ViewData["Title"] =  Model.Product.Name;
	var titleImage = Model.ColorId != null ? Model.Product.ProductImages.First(a => a.ColorId == Model.ColorId) : Model.Product.ProductImages.First(a => a.IsTitleImage);
}

<div class="container-indent" id="product">
	<!-- mobile product slider  -->
	<div class="tt-mobile-product-layout visible-xs">
		<div class="tt-mobile-product-slider arrow-location-center slick-animated-show-js">
			@foreach (var image in Model.Product.ProductImages.OrderByDescending(a => a.ColorId == Model.ColorId))
			{
				<div><img src="@Url.Action("Show","Home", new {name = image.FileName, extension = image.FileExtension})" alt=""></div>
			}
		</div>
	</div>
	<!-- /mobile product slider  -->
	<div class="container">
		<div class="row airSticky_stop-block">
			<div class="col-lg-12">
				<div class="row ">
					<div class="col-md-12 col-lg-6 hidden-xs">
						<div class="airSticky deactivate-sticky airSticky_fixed" style="width: 580px; position: fixed; top: 70px;">
							<div class="tt-product-vertical-layout clearfix">
								<div class="tt-product-single-img">
									<div>
										<button class="tt-btn-zomm tt-top-right"><i class="icon-f-86"></i></button>
										<img class="zoom-product" src="@Url.Action("Show","Home", new {name = titleImage.FileName, extension = titleImage.FileExtension})" data-zoom-image="@Url.Action("Show","Home", new {name = titleImage.FileName, extension = titleImage.FileExtension})" alt="">
									</div>
								</div>
								<div class="tt-product-single-carousel-vertical">
									<ul id="smallGallery" class="tt-slick-button-vertical slick-animated-show-js slick-vertical slick-slider">
										<div aria-live="polite" class="slick-list draggable" style="height: 305px;">
											<div class="slick-track" role="listbox" style="opacity: 1; height: 484px; transform: translate3d(0px, 0px, 0px);">
												@{
													int i = 0;
													@foreach (var image in Model.Product.ProductImages.OrderByDescending(a => a.ColorId == Model.ColorId))
													{
														if (i == 0)
														{
															<li class="slick-slide slick-current slick-active" tabindex="-1" role="option" aria-describedby="slick-slide20" style="width: 81px;" data-slick-index="@i" aria-hidden="false">
																<a class="zoomGalleryActive" href="#" data-image="@Url.Action("Show", "Home", new {name = image.FileName, extension = image.FileExtension})" data-zoom-image="@Url.Action("Show", "Home", new {name = image.FileName, extension = image.FileExtension})" tabindex="0">
																	<img src="@Url.Action("Show", "Home", new {name = image.FileName, extension = image.FileExtension})" alt="" class="loading" data-was-processed="true">
																</a>
															</li>
														}
														else
														{
															<li class="slick-slide slick-active" tabindex="-1" role="option" aria-describedby="slick-slide21" style="width: 81px;" data-slick-index="@i" aria-hidden="true">
																<a href="#" data-image="@Url.Action("Show", "Home", new {name = image.FileName, extension = image.FileExtension})" data-zoom-image="@Url.Action("Show", "Home", new {name = image.FileName, extension = image.FileExtension})" tabindex="0">
																	<img src="@Url.Action("Show", "Home", new {name = image.FileName, extension = image.FileExtension})" alt="" class="loading" data-was-processed="true">
																</a>
															</li>
														}

														i++;
													}
												}
											</div>
										</div>
									</ul>
								</div>
							</div>
						</div>
					</div>
					<div class="col-md-12 col-lg-6">
						<div class="tt-product-single-info">
							<h1 class="tt-title">@Model.Product.Name</h1>
							<div class="tt-price">
								<span>₽@Model.Product.Prices.First(a => a.ProductSizeId == Model.SizeId).Value</span>
							</div>
							<div class="tt-wrapper">
								@Model.Product.Description
							</div>
							<div class="tt-swatches-container">
								<div class="options">
									<div class="tt-wrapper" id="input-option218">
										<div class="tt-title-options"><label class="control-label" for="input-option218">Размер:</label></div>
										<div class="form-group required">
											<ul class="tt-options-swatch options-large">
												@foreach(var size in Model.Product.Prices.Select(a => a.ProductSize))
												{
													<li onclick="location.href='@Url.Action("Product","Product", new {id = Model.Product.Id, sizeId = size.Id, colorId = Model.ColorId})';" class="@(Model.SizeId == size.Id ? "active" : "")">
														<a>
															@($"{size.Name} ({size.Size})")
														</a>
													</li>
												}
											</ul>
										</div>
									</div>
									<div class="tt-wrapper" id="input-option223">
										<div class="tt-title-options"><label class="control-label" for="input-option223">Цвет:</label></div>
										<div class="form-group required">
											<ul class="tt-options-swatch options-large">
												@foreach(var color in Model.Product.ProductImages.Where(a => a.Color != null).Select(a => a.Color).GroupBy(a => a.Id).Select(a=>a.First()))
												{
													<li onclick="location.href='@Url.Action("Product","Product", new {id = Model.Product.Id, sizeId = Model.SizeId, colorId = color.Id})';" class="@(Model.ColorId == color.Id ? "active" : "")">
														<a class="options-color">
															<span class="swatch-img">
																<input type="checkbox" class="d-none" name="option[223][]" value="9">
																<img src="@Url.Action("Show","Home", new {name = color.ImageEntity.FileName, extension = color.ImageEntity.FileExtension})" alt="" class="loading" data-was-processed="true">
															</span>
														</a>
													</li>
												}
											</ul>
										</div>
									</div>
									<div class="tt-wrapper">
										<div class="tt-row-custom-01">
											<div class="col-item">
												<div class="tt-input-counter style-01">
													<span class="minus-btn"></span>
													<input type="text" name="quantity" id="quantity_wanted" size="200" value="1">
													<span class="plus-btn"></span>
												</div>
											</div>
											<div class="col-item">
												<input type="hidden" name="product_id" value="42">
												<a href="@Url.Action("Buy","Cart", new {id = Model.Product.Id, colorId = Model.ColorId, sizeId = Model.SizeId, quantity = 1})" class="btn btn-lg @(Model.ColorId == null ? "disabled" : "")" id="button-cart" data-loading-text="Loading..." data-original-text="Add to Cart"><i class="icon-f-39"></i><span>Добавить в корзину</span></a>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<script>
	$("#quantity_wanted").on("change paste keyup", function() {
		var val = $(this).val();
		var link = $("#button-cart").attr("href");
		var newLink = link.substring(0, link.lastIndexOf('&')) + '&quantity=' + val;
		$("#button-cart").attr("href", newLink);
	});
</script>
